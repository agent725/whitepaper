\documentclass[a4paper]{article}

\title{Internet of Coins\\[6mm]
\small{Hybrid Assets for Peer-to-Peer Inter-Blockchain Value Transfer}
}

\makeindex

\begin{document}
\maketitle

\newcommand{\hybridd}{\texttt{hybridd}\, }
\newcommand{\stormwind}{\texttt{STORMWIND}\, }


\begin{abstract}
 A meta-protocol and blockchain integration solution for transacting value across different digital currency systems would allow for multiple decentralized financial platforms to exchange value and thus form a coherent cryptosphere, without needing intermediary financial institutions. Third party services currently assist users to exchange one form of digital cash or asset for another, but a trusted third party is still required to mediate the transactions. We propose a solution to the problem of isolated digital currency systems using a meta-level transfer protocol with an extendable design, making accessible any kind of blockchain-based economy or other digital cash system for cross-blockchain and inter-system transactions. A dynamic proof-of-allocation mechanism provides verification of solvency to any of the transferable assets on such a high-level platform, and makes it possible for anonymous allocation providers to earn rewards to be part of an autonomous, decentralized exchange system. Simultaneously, any network participant may act as an agent for the realization of an encrypted exchange of value between two peers. Information is transacted across the blockchains or digicash systems of the respective value-holders being traded, while node connections are directly negotiated without retaining or storing any records. As with Bitcoin, the network itself requires minimal structure, and messages are broadcast on a best effort basis. Peer connections employ failover restructuring of transactions and messaging, and nodes can leave and rejoin the network at will, updating their allocation tables from any random node.
\end{abstract}

\section{Introduction}
Since the inception of Bitcoin, we have seen the rise of many digital cash descendants that either imitate or replicate the peer-to-peer version of electronic cash that Bitcoin was designed to be. Next to blockchain technology, decentralized asset exchanges\cite{counterparty} have been built to facilitate the issuance of virtual assets. Ledgerless \cite{opentransactions} systems are also in development. While the existing solutions may function as intended, exchanges in value between these systems and blockchains is most often done through trusted third parties. This re-introduces the inherent weaknesses of the traditional trust based financial models into the cryptosphere of peer-to-peer digital currencies. In many cases this is no direct threat to the usage and trade of these currencies. Yet at the same time it isolates the different implementations of digital cash from eachother, except for their value being tied to Bitcoin. This exposes these currencies to price manipulation strategies that have the potential to drain all value from these markets. \cite{panture}

What is needed is a hybrid asset and transfer system utilizing a modular and standardized peer-to-peer platform, instead of trust. A loosely coupled system\cite{EDA} allowing any two willing parties to transact assets cross-blockchain with each other, without the need for a trusted third party. Transaction methods that have no systemic boundaries and can operate cross-blockchain tie different value systems together. Through hybrid assets, loosely coupled financial systems make the cryptosphere immune to intermediary control by trusted parties and stabilizes crypto-economies by insuring the value of smaller smaller markets can transfer into hybrid assets in the event of network destabilization. In this paper, we propose a solution to the digital economy diaspora using a peer-to-peer, distributed, inter-blockchain exchange server to mediate the transfer of value between digital value systems.

\section{Inter-Blockchain Transactions}

We define a hybrid asset as a blockchain agnostic set of tokens\cite{coloredcoins} allocated on top of multiple digital value exchanges, and in some cases multiple blockchains. The asset may gain external value when its issuer decides to prove the asset's contextual value by proof-of-burn\cite{proofofburn}. Asset holders on the hybrid network have either issued the asset themselves, or have obtained it on a decentralized asset exchange. Our proposed network daemon (hybridd) 'glues' crypto-assets and coins together by passing around datasets or tables, in a FIFO blocks tream, that contain identification information about each invidual blockchain-based asset, and rulesets that govern their relationship to form a hybrid asset. This allows for the creation of assets that have the flexibility to pass their value from blockchain to blockchain. An owner may transfer the asset to another blockchain by cryptographically proposing a transaction to which any other peer on the hybridd network may respond. To make these kinds of transactions possible, an allocator node on the network must have allocated a certain amount of assets or coins to be used for inter-blockchain transactions. Information about allocators that hold such amounts is shared through the network, and constitutes a dynamic proof-of-allocation table for each network node.

Communication between exchanging peers goes through an anonymous third party swarm of nodes that act as an escrow on the network. The nodes in this group use threshold cryptography to ensure impartial activity as a swarm or hive. Both the initiator of a transaction (Alice) and an allocator (Bob) create a new private and public addresses which are sent to the swarm escrow (we call this group Cipher). On receiving public keys from Alice and Bob, Cipher also creates additional keypairs to prepare for a multisignature transaction\cite{multisig}.

Both private keys and public keys are cryptographic numbers which can be added or multiplied, and in a multisignature transaction the public key corresponding to the private keys that is a combination of two other keys is simultaneously the sum of two public keys. Alice and Bob's private keys are received in encrypted form by Cipher. It cannot use these keys, however, as they are encrypted with a public key of the counterparty of the transaction. Cipher sends back public addresses so Alice and Bob can send the amount to be traded to two escrow addresses. Cipher verifies these transactions for both parties, and waits for the transactions to confirm on the blockchains. As soon as there are enough confirmations visible to Cipher on the combined multisignature public addresses of Alice and Bob, it sends both parties the encrypted private key and its own generated private key. On receiving the keys, Alice and Bob decrypt the encrypted key and combine it with Ciphers generated private key, and spend from the resulting private key, sending the stored value at that address into their own wallet.

What makes this a safe method of exchange is that the encrypted private keys can only be released to the transactors (Alice and Bob) at the right time, yet they cannot be used by the escrow swarm (Cipher) to influence the transaction itself. Thus the anonymous third party has no influence on the value of the exchange being done between the two exchanging parties, except for verifying, and finalizing the transactions of both peers. In case of failure (Cipher drops offline) or a timeout, both Alice and Bob transfer and receive the multisignature keys from another peer, as the network employs failover strategies to ensure transaction can be completed. This could be done, for example, by multiplexing the transaction over multiple anonymous escrows. By using multisignature transactions, a successful swiping-attack during the transaction becomes highly improbable. In case a digital value system does not support multisignature transactions see chapter 10 for an alternative.

\section{Meta Server}
To be able to integrate technically incompatible value models and peer-to-peer blockchains, we must take the approach of creating a peer-to-peer meta server that loosely couples current digital value systems on a high level, and makes trusted third parties unnecessary. This meta-structure should provide hooks to which abstract concepts of digital value systems and blockchain technologies can be connected and integrated - a modular and open extension platform facilitates the implementation of different kinds of hybrid value systems in pluggable modules that unify the overlapping functionalities of different blockchains and ledgerless systems.

The meta-server networking daemon (hybridd) must use a concise and practical encrypted communications protocol and functions modularly  on top of existing anonymous routing networks such as, for example, TOR\cite{tor}, I2P\cite{i2p}, or GNUnet\cite{gnunet}, using them as a transport. This safeguards the possibility of easily identifying individual node IP addresses. Peer ID's, and their public keys are shared among peers like data in a distributed hash table\cite{dht}. Each PeerID is subject to a lease, and the entries of the peertable are occasionally being verified by participants on the network and timestamped.

\section{Proof-of-Allocation}

To make sure peers are able to determine the viability of a transaction before initiating one, we will need to use a proof-of-allocation (POA) table. To ensure the information in this table is correct, peers perform ledger auditing and verification when they have matching extensions to access the blockchain or system on which the allocated amount is located. The POA table can be interpreted by individual nodes to ensure which transaction combinations are possible and viable, and which peers are eligible for transaction.

In the example you will notice there are four addresses holding the asset \stormwind, according to the POA table. Each node with access to NXT-AE (NXT) and CounterParty (XCP) blockchains is able to verify the allocated amount of assets specified in the table. By combining the information from a local database, a node can deduct that in this example the asset \stormwind has an allocation of 96,425 on the NXT blockchain and 49,500 on the XCP blockchain. The total proof-of-allocation amount would in this case be simply 145,925 units.

\section{Network}

The meta-server can theoretically bootstrap the network over any existing darknet. As previously mentioned, we will use TOR as our example. The bootstrapping process would be as follows:

\begin{enumerate}
\item New nodes consult their latest PeerID table to connect to 8 other peers
\item Each node contacts the oldest peers of its PeerID table to determine their status
\item Each node verifies the POA table where possible using its extensions
	    for connecting to other blockchains
\item When a node mediates as an escrow, it verifies the transacting peers,
	    mediates the transaction and updates the POA table
\item Each node updates its peers with its latest PeerID and POA tables
\item Nodes accept other PeerID and POA tables, verify and merge them with their own
\item Tables are sorted and pruned and only diffs of the data are shared with other peers
\end{enumerate}

Essentially the meta server provides an access and control communications layer on top of existing blockchains, or light-clients. This means \hybridd can be run on full blockchains or connect to API's for value transfer. Whatever the user prefers and has resources for. In the case of enough storage space, direct access to blockchains would be preferred. The following figure shows an example layout of how \hybridd could be bootstrapped into the networks.

As the figure implies, the possibilities for inter-blockchain transactions opens a plethora of decentralized trading options and asset combinations. Competitive crypto-platforms become cooperative economic ecosystems in which users and communities have freedom to innovate indiscriminately. Large changes to individual blockchains or RPC API's can be adapted to by the hybridd network simply by rewriting one of its extensions, whether concerning high-level transacting or low-level atomic cryptography. Smaller, declining cryptocurrencies can be bound together in hybrid assets giving survivability, and exchange flexibility to these coins.

\section{Incentive}

In a transaction we have an initiator and a responder. Responders are simultaneously asset holders who have allocated their assets for trading. When initator Alice starts a transaction, the amount of assets she receives from allocator Bob will always be a little less than the amount she sends. The ratio for conversion is yet to be defined, but for now defaults to: $1N : 0.999N$.  The allocator retains a small amount, and thus is rewarded for providing Alice with an instant migration of her assets between systems. The costs of conversion are default very low: between $0.1\%$ and $0.2\%$, or the lowest possible denomination of value in a specific asset. Costs of conversion, however, can also be set to another amount by the network, to define an autonomously organized context for optimal liquidity. This should make large transactions relatively inexpensive, while microtransactions are also decentrally regulated to avoid spamming on the network.

The more allocators appear on the network, the more competition they have amongst eachother to be chosen for a transaction, lowering the incentive for popular coins, while attracting allocators to abandoned blockchains. This balances out the amount of allocators, yet still brings in enough responders to keep the network active as a whole and its assets liquid.

Perhaps, for instance, an allocator may be able to provide services for some blockchains, but not for others. If there are a great amount of responders for the Bitcoin blockchain, but only a few for NXT, the Bitcoin allocators will relatively be less rewarded and the NXT allocators more rewarded for their services over time. This balances out the incentive towards individual services, and their supply and demand for individual blockchains.


\section{Unified Asset Descriptor}

Information about hybrid assets is passed around the network in signed arrays called unified asset descriptors (UAD). They contain the combined asset ID's, minimum and maximum cost of conversion, bcrypt sums thereof, further descriptive information, and are signed by the creator of the hybrid asset. This makes it possible for individual nodes to verify that an asset cannot be hijacked by anyone other than the issuer. Based on the existance of a signed unified asset descriptor, the lease of a PeerID in the shared table is periodically renewed.

Certain aspects of a UAD can be changed, while other things cannot. Linked assets may not be removed from a UAD once added for over 48 hours to protect stakeholders of a hybrid asset. Adding new assets to become part of the hybrid, however, is not prohibited. This makes it possible for a hybrid asset to evolve and become part of more blockchains at a point in time beyond its inception. The description of a hybrid asset may also be changed to reflect intelligible updates to the assets constitution.

Changes to an asset are temporarily recorded and buffered in a FIFO blockstream with 2048 bytes of active data space and at least several historic revisions. This gives possibilities to revert the asset changes to previous states if necessary. Again, decoupling an internal asset from the UAD is only possible within 48 hours of committing the change. A small blockstream keeps the meta-server light enough for anyone with several gigabytes of diskspace to make use of it. Downloading multiple blockchains on one computer may be more than enough of a challenge for an average user. Let's not make the pain any worse.


\section{Cross-Blockchain Distributed Autonomous Organizations}

Many crypto-asset and cryptocurrency teams claim to have a working platform for distributed autonomous organizations (DAO), however, the most flexible and powerful platforms for this seem currently (2014.07.22) to be Ethereum, and NXT. Many other platforms rely on rudimentary scripting to give a minimal service level of distributed autonomy.

In itself \hybridd contains no platform for DAO operations. Instead we want to facilitate the efforts that are already available to us on other blockchain platforms. Considering another option would be to create an Ethereum extension to tap into the distributed power of its DAO platform. An Ethereum contract could then autonomously make decisions and relay the results back into the hybrid assets blockstream to create cross-blockchain services.

Extending into DAO territory can also be done on other platforms. This, however, depends largely on the motivations for module developers to want this. In any case, reinventing the wheel would be a waste of time and resources, while combining the power of both hybrid assets and any truly DAO enabled platform leverages the possibilities of both, and can make DAO's truly cross-blockchain without relying on a trusted party.


\section{Value and Allocation Theory}

When issuing a hybrid asset we must take into account the necessary allocation overhead to ensure the assets are liquid and transferrable to other systems and blockchains. This overhead may have the effect of inflating the price of the asset, however, as more allocators enter the market the opposite may also be true. Let's do a little contemplation on value and allocation to anticipate the effects of allocation reliance and resulting behaviour of market participants in more extreme market conditions.

If part of a hybrid asset becomes scarce in the market, it could effectively become subject to deflation mechanisms on any of its host blockchains. For example: if we issue the hybrid asset APPLES on NXT-AE, Ethereum and Counterparty\cite{counterparty}, and are looking to ensure at least $30\%$ allocation, we need enough incentive for participants in the network to allocate such an amount. The incentive is nominally provided by the maximum percentual cost of conversion by the asset issuer, and – in most cases – provides enough allocators for cross-blockchain liquidity, because of the incentive structure.

As long as prices on separate blockchains remain tied to common market ranges, allocations should autonomously balance out because of the effect of demand and supply in the markets. However, if for some reason many holders of a hybrid asset choose to exit one of the individual host platforms and flee into another, this may create an imbalance in price for the asset between chains. Also the mass-abandonment of a host platform by users could effectively cause the perceived value of the asset on that specific platform to become unstable. In such extreme circumstances allocation resources could be exhausted.

Usually allocation service providers in the \hybridd network will have enough incentive to keep on staking more allocated funds in order to return the market to balance. Perhaps some may seek to repair the allocation shortage by trading over other exchanges; thereby taking some risk and reaping profits. Additionally, a shortage of allocators will make for increased profits among the few that are left. These will attempt to process all transactions that now have no place to be handled elsewhere.

Our thought experiment makes evident the hybrid assets ecosystem invites participants to become allocators, thereby creating a self-regulated decentralized market.

\section{Haystack Transactions}

Some platforms may never support multisignature transactions. Take for instance some of the dying cryptocurrencies that have considerably dropped in value and hashingpower. Some of them are closed-source. Swapping value between these chains would seem impossible without using a trusted third party. However, by using high-level scripting and a large stack of private and public keys we may mathematically increase the difficulty of one of the parties prematurely spending funds in transaction. Thus we can still attempt to transfer value among such systems.

To solve the dilemma of not having multisignature transactions at our disposal, we make use of a haystack transaction method to give both transacting parties enough time to redeem the value they are receiving before their counterparty can swipe it. In this case both Alice and Bob create thousands of private and public keys for a single transaction. Depending on the amount of security needed for the transaction, more keys can be generated. This is a haystack of addresses, and what they all have in common is that they share an incomplete private key. Both Alice and Bob randomly select 100,000 addresses from this haystack for the other to send their funds to. The Cipher swarm receives these public keys from Alice and Bob, chooses one from each stack using decentralized consensus, sends them on to the counterparty and applies a trigger. Next to that the swarm receives private key completion hashes that are distributed among nodes using threshold cryptography. Meanwhile Alice and Bob both share incomplete private keys from which they can generate any of ten million combinations. When both transactions show enough confirmations on the blockchains, Cipher immediately releases the corresponding private keys to Alice and Bob, who then know the needle from the haystack and can spend from the addresses to receive their transaction value.

In case the transaction goes awry, Cipher can send both parties a private key hash in order for them to retrieve their funds. The whole private key must not be known to Cipher, while Alice and Bob must still be able to ensure the key is a valid. For this we make use of a key completion method. Both Alice and Bob share an incomplete private key, which can be completed by a hash of at least four characters giving $N=58^4$ different combinations.


This transaction method should only be used mainly as a fallback, since it can be more easily exploited than a multisignature transaction. If Bob wanted to try and redeem the escrow amount of Alice before paying his own amount due, he would have to monitor 100,000 public addresses for the incoming funds, and would need to race Alice in spending the value as soon as it is confirmed. As blockchains always have some delay before payments are confirmed, Cipher can see if both parties have sent funds to the specified addresses. The slowest blockchain determines when both transactions have been broadcast into the networks. The haystack delay method will make it difficult for Alice and Bob to prematurely spend an incoming transaction, but it is only a matter of time before they can work through all the addresses by brute force.


The approach described is vulnerable to a serious attacker with enough resources to monitor all generated receiver addresses simultaneously and attempt to target the right address for spending right after the first confirmation. However, this is a brute-force attack that would take a considerable amount of resources, as shown in our calculations below, while the rewards would be relatively small, since haystack transactions are mostly intended to be used as a fallback.

\subsection{Calculations}

When using the haystack transaction method, a transaction may take no more than a certain amount of time. Let's suppose checking each address for available funds takes at least one microsecond. If Alice or Bob wants to prematurely swipe the funds they are receiving they would need to go over 100000 addresses:

\begin{displaymath}
	(100000 * 0.01) / 60 = \mathrm{16 minutes and 40 seconds}
\end{displaymath}

The chances of hitting the right address sooner can be calculated to its average probability: 

\begin{center}
	??? 	[ Math here is far from complete! Need mathematician! ]
\end{center}


In the case of Alice or Bob wanting to swipe both transactions simultaneously and steal all the funds it takes time to scan through the entire haystack.

Going over all addresses sequentially would take:

\begin{displaymath}
	(58^4 * 0.01) / 3600 = \mathrm{31 hours, 25 minutes and 48 seconds}
\end{displaymath}

The chances of hitting the right address sooner is probable:

\begin{center}
	??? 	[ Math here is far from complete! Need mathematician! ]
\end{center}

Transferring the haystack over TOR\cite{tor} would take at least 16 seconds when considering the average download speed is 240Kb per second.

Many internet connections in the world, however, currently have slower upload speeds. 50Kb per second on average is not uncommon in the Netherlands. This means the following transfer duration:

\begin{displaymath}
	3000000?? / (50*1000) = \mathrm{3 minutes and 3 seconds}
\end{displaymath}

For a small value transaction, however, less addresses may suffice. This also means less data needs to be transferred across the network making a transaction complete sooner.

\section{Conclusion}

We have proposed a decentralized network transaction system for hybrid assets and decentralized transactions without relying on trusted third parties. Initially we defined decentralized assets, and described the threat of isolated cryptocurrencies and blockchains, with only centralized actors for exchanging value between these systems. To solve this, we proposed a peer-to-peer network operating over darknets to enable users to transact value across blockchains and value systems. 
By using multisignature transactions as a cryptographically secure method, advanced cryptography technology can be used for secure cross-blockchain transactions. In case of value systems without multisignature support, we have the possibility to fall back to transactions using the haystack transaction method. The network is self-balancing, anonymized and robust, using threshold cryptography for swarm escrow functionality. Nodes share information about hybrid assets across the network. Nodes can leave and rejoin the network at will, sharing proof-of-allocation tables containing data about the allocations and capabilities of each individual node. Value allocation and transactions are automatically managed by the allocating nodes, hybrid assets have a one-on-one inter-blockchain value definition, and prices for transacting value are market driven.



\section{References}

\bibliography{internetofcoins}{}
\bibliographystyle{plain}

\end{document}
